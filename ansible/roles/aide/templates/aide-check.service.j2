[Unit]
Description=AIDE Integrity Check
Documentation=man:aide(1)
After=local-fs.target

[Service]
Type=oneshot
User=root
Group=root
ExecStart=/usr/local/bin/aide-check.sh
StandardOutput=journal
StandardError=journal
Environment=LC_ALL=C
Environment=LANG=C

# Security settings
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/lib/aide /var/log/aide {{ aide_report_dir | default('/var/lib/aide/reports') }}
PrivateTmp=true
ProtectKernelTunables=true
ProtectKernelModules=true
ProtectControlGroups=true
RestrictRealtime=true
RestrictSUIDSGID=true

# Resource limits
MemoryLimit={{ aide_memory_limit | default('1G') }}
TimeoutStartSec={{ aide_timeout | default('1800') }}

[Install]
WantedBy=multi-user.target